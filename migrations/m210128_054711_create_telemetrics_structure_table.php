<?php

use yii\db\Migration;

/**
 * Handles the creation of table `{{%telemetrics_structure_smart}}`.
 */
class m210128_054711_create_telemetrics_structure_table extends Migration
{
    /**
     * {@inheritdoc}
     */
    public function safeUp()
    {
        $this->createTable('{{%telemetrics_structure_smart}}', [
            'id' => $this->primaryKey(),
            'alias' => $this->string(),
            'flex_id' => $this->integer(),
            'description' => $this->text(),
            'length' => $this->integer(),
            'multiplier' => $this->decimal(20, 20),
            'type' => $this->string()
        ]);
        
        \Yii::$app->db->createCommand()->batchInsert('{{%telemetrics_structure_smart}}',
            ['flex_id', 'alias', 'length', 'description', 'multiplier', 'type'],
            $this->mergeData()
        )->execute();
    }

    /**
     * {@inheritdoc}
     */
    public function safeDown()
    {
        $this->dropTable('{{%telemetrics_structure_smart}}');
    }

    private function mergeData()
    {
        $ins = $this->insertValues();
        $other = $this->outherValues();
        foreach($ins as $insRow) {
            foreach($other as &$othRow) {
                if ($insRow[0] === $othRow[0]) {
                    $othRow = $insRow;
                }
            }
        }

        return $other;
    }

    private function insertValues()
    {
        return [
            [1, 'memID', 4, 'Сквозной номер записи в энергонезависимой памяти', null, 'U32' ],
            [2, 'eventCode', 2, 'Код события, соответствующий данной записи', null, 'U16' ],
            [3, 'timestamp', 4, 'Время события', null, 'U32' ],
            [4, 'status', 1, 'Статус устройства', null, 'U8'],
            [7, 'gnsLvl', 1, 'Уровень GSM', null, 'U8'],
            [8, 'gpsState', 1, 'Состояние навигационного датчика GPS/ГЛОНАСС', null, 'U8'],
            [9, 'lastValidTime', 4, 'Время последних валидных координат (до произошедшего события)', null, 'U32'],
            [10, 'lat', 4, 'Последняя валидная широта', 0.0000016666666666667, 'I32'],
            [11, 'lng', 4, 'Последняя валидная долгота', 0.0000016666666666667, 'I32'],
            [12, 'alt', 4, 'Последняя валидная высота', 0.1, 'I32'],
            [13, 'speed', 4, 'Скорость', null, 'Float'],
            [19, 'voltage', 2, 'Напряжение на основном источнике питания', 0.001, 'U16'],
            [29, 'dinStates', 1, 'Текущие показания дискретных датчиков 1', null, 'U8'],
            [31, 'doutStates', 1, 'Текущее состояние выходов 1 ', null, 'U8'],
            [124, 'funcModule3', 1, 'Статус функиональных модулей 3', null, 'U8']
        ];
    }

    private function outherValues()
    {
        return [
            [1, null, 4, "Сквозной номер записи в энергонезависимой памяти", null, null],
            [2, null, 2, "Код события, соответствующий данной записи", null, null],
            [3, null, 4, "Время события", null, null],
            [4, null, 1, "Статус устройства", null, null],
            [5, null, 1, "Статус функциональных модулей 1", null, null],
            [6, null, 1, "Статус функциональных модулей 2", null, null],
            [7, null, 1, "Уровень GSM", null, null],
            [8, null, 1, "Состояние навигационного датчика GPS/ГЛОНАСС", null, null],
            [9, null, 4, "Время последних валидных   координат (до произошедшего события)", null, null],
            [10, null, 4, "Последняя валидная широта", null, null],
            [11, null, 4, "Последняя валидная долгота", null, null],
            [12, null, 4, "Последняя валидная высота", null, null],
            [13, null, 4, "Скорость", null, null],
            [14, null, 2, "Курс", null, null],
            [15, null, 4, "Текущий пробег", null, null],
            [16, null, 4, "Последний отрезок пути", null, null],
            [17, null, 2, "Общее количество секунд на последнем отрезке пути", null, null],
            [18, null, 2, "Количество секунд на последнем отрезке пути, по которым вычислялся пробег (валидная  навигация)", null, null],
            [19, null, 2, "Напряжение на основном источнике питания", null, null],
            [20, null, 2, "Напряжение на резервном  источнике питания", null, null],
            [21, null, 2, "Напряжение на аналоговом входе 1 (Ain1)", null, null],
            [22, null, 2, "Напряжение на аналоговом входе 2   (Ain2)", null, null],
            [23, null, 2, "Напряжение на аналоговом входе 3 (Ain3)", null, null],
            [24, null, 2, "Напряжение на аналоговом входе 4 (Ain4)", null, null],
            [25, null, 2, "Напряжение на аналоговом входе 5   (Ain5)", null, null],
            [26, null, 2, "Напряжение на аналоговом входе 6 (Ain6)", null, null],
            [27, null, 2, "Напряжение на аналоговом входе 7 (Ain7)", null, null],
            [28, null, 2, "Напряжение на аналоговом входе 8   (Ain8)", null, null],
            [29, null, 1, "Текущие показания дискретных датчиков 1", null, null],
            [30, null, 1, "Текущие показания дискретных датчиков 2", null, null],
            [31, null, 1, "Текущее состояние выходов 1", null, null],
            [32, null, 1, "Текущее состояние выходов 2", null, null],
            [33, null, 4, "Показания счетчика импульсов 1", null, null],
            [34, null, 4, "Показания счетчика импульсов 2", null, null],
            [35, null, 2, "Частота на аналогово-частотном датчике уровня топлива 1", null, null],
            [36, null, 2, "Частота на аналогово-частотном   датчике уровня топлива 2", null, null],
            [37, null, 4, "Моточасы, подсчитанные во время срабатывания датчика работы   генератора", null, null],
            [38, null, 2, "Уровень топлива, измеренный датчиком уровня топлива 1 RS-485", null, null],
            [39, null, 2, "Уровень топлива, измеренный датчиком уровня топлива 2 RS-485", null, null],
            [40, null, 2, "Уровень топлива, измеренный датчиком уровня топлива 3 RS-485", null, null],
            [41, null, 2, "Уровень топлива, измеренный датчиком уровня топлива 4 RS-485", null, null],
            [42, null, 2, "Уровень топлива, измеренный датчиком уровня топлива 5 RS-485", null, null],
            [43, null, 2, "Уровень топлива, измеренный датчиком уровня топлива 6 RS-485", null, null],
            [44, null, 2, "Уровень топлива, измеренный датчиком уровня топлива RS-232", null, null],
            [45, null, 1, "Температура с цифрового датчика 1 (в градусах Цельсия)", null, null],
            [46, null, 1, "Температура с цифрового датчика 2   (в градусах Цельсия)", null, null],
            [47, null, 1, "Температура с цифрового датчика 3 (в градусах Цельсия)", null, null],
            [48, null, 1, "Температура с цифрового датчика 4 (в градусах Цельсия)", null, null],
            [49, null, 1, "Температура с цифрового датчика 5   (в градусах Цельсия)", null, null],
            [50, null, 1, "Температура с цифрового датчика 6 (в градусах Цельсия)", null, null],
            [51, null, 1, "Температура с цифрового датчика 7 (в градусах Цельсия)", null, null],
            [52, null, 1, "Температура с цифрового датчика 8   (в градусах Цельсия)", null, null],
            [53, null, 2, "CAN  Уровень топлива в баке", null, null],
            [54, null, 4, "CAN   Полный расход топлива", null, null],
            [55, null, 2, "CAN Обороты двигателя", null, null],
            [56, null, 1, "CAN   Температура охлаждающей жидкости (двигателя)", null, null],
            [57, null, 4, "CAN  Полный пробег ТС", null, null],
            [58, null, 2, "CAN  Нагрузка на ось 1", null, null],
            [59, null, 2, "CAN  Нагрузка на ось 2", null, null],
            [60, null, 2, "CAN  Нагрузка на ось 3", null, null],
            [61, null, 2, "CAN   Нагрузка на ось 4", null, null],
            [62, null, 2, "CAN   Нагрузка на ось 5", null, null],
            [63, null, 1, "CAN   Положение педали газа", null, null],
            [64, null, 1, "CAN   Положение педали тормоза", null, null],
            [65, null, 1, "CAN  Нагрузка на двигатель", null, null],
            [66, null, 2, "CAN   Уровень жидкости в дизельном фильтре выхлопных газов", null, null],
            [67, null, 4, "CAN  Полное время работы двигателя", null, null],
            [68, null, 2, "CAN  Расстояние до ТО", null, null],
            [69, null, 1, "CAN  Скорость ТС", null, null],
            [70, null, 8, "Информация о навигации", null, null],
            [71, null, 2, "HDOP/ PDOP штатного приёмника", null, null],
            [72, null, 1, "Состояние дополнительного высокоточного навигационного приёмника", null, null],
            [73, null, 16, "Широта/ долгота координаты от высокоточного приёмника", null, null],
            [74, null, 4, "Высота от высокоточного приёмника", null, null],
            [75, null, 2, "Курс от высокоточного приёмника", null, null],
            [76, null, 4, "Скорость от высокоточного приёмника", null, null],
            [77, null, 37, "Информация о текущей базовой станции/ соседней станции №1, №2 (LBS) ", null, null],
            [78, null, 1, "Температура, измеренная датчиком уровня топлива 1 RS485", null, null],
            [79, null, 1, "Температура, измеренная датчиком уровня топлива 2 RS485", null, null],
            [80, null, 1, "Температура, измеренная датчиком уровня топлива 3 RS485", null, null],
            [81, null, 1, "Температура, измеренная датчиком уровня топлива 4 RS485", null, null],
            [82, null, 1, "Температура, измеренная датчиком уровня топлива 5 RS485", null, null],
            [83, null, 1, "Температура, измеренная датчиком уровня топлива 6 RS485", null, null],
            [84, null, 3, "Уровень топлива и температура измеренные датчиком уровня топлива 7 RS485", null, null],
            [85, null, 3, "Уровень топлива и температура измеренные датчиком уровня топлива 8 RS485", null, null],
            [86, null, 3, "Уровень топлива и температура измеренные датчиком уровня топлива 9 RS485", null, null],
            [87, null, 3, "Уровень топлива и температура измеренные датчиком уровня топлива 10 RS485", null, null],
            [88, null, 3, "Уровень топлива и температура измеренные датчиком уровня топлива 11 RS485", null, null],
            [89, null, 3, "Уровень топлива и температура измеренные датчиком уровня топлива 12 RS485", null, null],
            [90, null, 3, "Уровень топлива и температура измеренные датчиком уровня топлива 13 RS485", null, null],
            [91, null, 3, "Уровень топлива и температура измеренные датчиком уровня топлива 14 RS485", null, null],
            [92, null, 3, "Уровень топлива и температура измеренные датчиком уровня топлива 15 RS485", null, null],
            [93, null, 3, "Уровень топлива и температура измеренные датчиком уровня топлива 16 RS485", null, null],
            [94, null, 6, "Информация о 1-2 датчиках давления в шинах", null, null],
            [95, null, 12, "Информация о 3-6 датчиках давления в шинах", null, null],
            [96, null, 24, "Информация о 7-14 датчиках давления в шинах", null, null],
            [97, null, 48, "Информация о 15-30 датчиках давления в шинах", null, null],
            [98, null, 1, "Данные от тахографа: Активность водителей и состояние слотов карт.", null, null],
            [99, null, 1, "Режим работы тахографа/ карта", null, null],
            [100, null, 2, "Флаги состояния от тахографа", null, null],
            [101, null, 1, "Скорость по тахографу", null, null],
            [102, null, 4, "Одометр по тахографу", null, null],
            [103, null, 4, "Время по тахографу", null, null],
            [104, null, 1, "Текущее состояние водителя принятое от дисплейного модуля", null, null],
            [105, null, 4, "Индекс последнего полученного/прочитанного сообщения на дисплейном модуле.", null, null],
            [106, null, 2, "Приращение к времени относительно предыдущей записи", null, null],
            [107, null, 6, "Линейное ускорение по оси X, Y, Z", null, null],
            [108, null, 2, "EcoDriving. Длительность превышения порога", null, null],
            [109, null, 6, "EcoDriving. Максимальное значение   положительного, отрицательного (торможения), бокового ускорений за период", null, null],
            [110, null, 2, "Данные счетчиков пассажиропотоков 1-2", null, null],
            [111, null, 2, "Данные счетчиков пассажиропотоков 3-4  ", null, null],
            [112, null, 2, "Данные счетчиков пассажиропотоков 5-6", null, null],
            [113, null, 2, "Данные счетчиков пассажиропотоков 7-8", null, null],
            [114, null, 2, "Данные счетчиков пассажиропотоков 9-10  ", null, null],
            [115, null, 2, "Данные счетчиков пассажиропотоков 11-12", null, null],
            [116, null, 2, "Данные счетчиков пассажиропотоков 13-14", null, null],
            [117, null, 2, "Данные счетчиков пассажиропотоков 15-16", null, null],
            [118, null, 1, "Статус автоинформатора", null, null],
            [119, null, 2, "ID последней геозоны", null, null],
            [120, null, 2, "ID последней остановки", null, null],
            [121, null, 2, "ID текущего маршрута", null, null],
            [122, null, 1, "Статус камеры", null, null],
            [123, null, 1, "Статус устройства 2", null, null],
            [124, null, 1, "Статус функциональных модулей 3", null, null],
            [125, null, 1, "Статус состояния связи", null, null],
            [126, null, 1, "Текущие показания дискретных датчиков 3", null, null],
            [127, null, 4, "Показания счетчика импульсов 3", null, null],
            [128, null, 4, "Показания счетчика импульсов 4", null, null],
            [129, null, 4, "Показания счетчика импульсов 5", null, null],
            [130, null, 4, "Показания счетчика импульсов 6", null, null],
            [131, null, 4, "Показания счетчика импульсов 7", null, null],
            [132, null, 4, "Показания счетчика импульсов 8", null, null],
            [133, null, 2, "Частота на аналогово-частотном датчике 3", null, null],
            [134, null, 2, "Частота на аналогово-частотном датчике 4", null, null],
            [135, null, 2, "Частота на аналогово-частотном датчике 5", null, null],
            [136, null, 2, "Частота на аналогово-частотном датчике 6", null, null],
            [137, null, 2, "Частота на аналогово-частотном датчике 7", null, null],
            [138, null, 2, "Частота на аналогово-частотном датчике 8", null, null],
            [139, null, 1, "Состояние виртуальных датчиков акселерометра", null, null],
            [140, null, 1, "Внутренний датчик угла наклона. Угол наклона относительно местной вертикали", null, null],
            [141, null, 2, "Внутренний датчик наклона. Углы наклона относительно отвесной линии", null, null],
            [142, null, 3, "Внешний датчик угла наклона. Отклонения по осям", null, null],
            [143, null, 2, "EcoDriving. Максимальное значение вертикального ускорения за период", null, null],
            [144, null, 1, "EcoDriving. Максимальное значение скорости за период", null, null],
            [145, null, 1, "EcoDriving. Состояние порогов скорости", null, null],
            [146, null, 3, "EcoDriving. Состояние порогов ускорения", null, null],
            [147, null, 2, "Частота на выходе ДУТ 485№1", null, null],
            [148, null, 2, "Частота на выходе ДУТ 485№2", null, null],
            [149, null, 2, "Частота на выходе ДУТ 485№3", null, null],
            [150, null, 2, "Частота на выходе ДУТ 485№4", null, null],
            [151, null, 2, "Частота на выходе ДУТ 485№5", null, null],
            [152, null, 2, "Частота на выходе ДУТ 485№6", null, null],
            [153, null, 2, "Частота на выходе ДУТ 485№7", null, null],
            [154, null, 2, "Частота на выходе ДУТ 485№8", null, null],
            [155, null, 2, "Частота на выходе ДУТ 485№9", null, null],
            [156, null, 2, "Частота на выходе ДУТ 485 №10", null, null],
            [157, null, 2, "Частота на выходе ДУТ 485 №11", null, null],
            [158, null, 2, "Частота на выходе ДУТ 485 №12", null, null],
            [159, null, 2, "Частота на выходе ДУТ 485 №13", null, null],
            [160, null, 2, "Частота на выходе ДУТ 485 №14", null, null],
            [161, null, 2, "Частота на выходе ДУТ 485 №15", null, null],
            [162, null, 2, "Частота на выходе ДУТ 485 №16", null, null],
            [163, null, 2, "Высокоточный датчик температуры 1", null, null],
            [164, null, 2, "Высокоточный датчик температуры 2", null, null],
            [165, null, 2, "Высокоточный датчик температуры 3", null, null],
            [166, null, 2, "Высокоточный датчик температуры 4", null, null],
            [167, null, 1, "Высокоточный датчик влажности 1", null, null],
            [168, null, 1, "Высокоточный датчик влажности 2", null, null],
            [169, null, 1, "Высокоточный датчик влажности 3", null, null],
            [170, null, 1, "Высокоточный датчик влажности 4", null, null],
            [171, null, 2, "Датчик расхода топлива. Статус датчика", null, null],
            [172, null, 4, "Датчик расхода топлива. Информация о неисправностях", null, null],
            [173, null, 4, "Датчик расхода топлива. Суммарный расход топлива", null, null],
            [174, null, 4, "Датчик расхода топлива. Расход топлива за поездку", null, null],
            [175, null, 2, "Датчик расхода топлива. Текущая скорость потока", null, null],
            [176, null, 4, "Датчик расхода топлива. Суммарный объем топлива камеры подачи", null, null],
            [177, null, 2, "Датчик расхода топлива. Текущая скорость потока камеры подачи", null, null],
            [178, null, 2, "Датчик расхода топлива. Температура камеры подачи", null, null],
            [179, null, 4, "Датчик расхода топлива. Суммарный объем топлива камеры обратки", null, null],
            [180, null, 2, "Датчик расхода топлива. Текущая скорость потока камеры обратки", null, null],
            [181, null, 2, "Датчик расхода топлива. Температура камеры обратки", null, null],
            [182, null, 2, "Рефрижераторная установка. Состояние установки", null, null],
            [183, null, 2, "Рефрижераторная установка. Температура рефрижератора в секции 1 (Температура ХОУ)", null, null],
            [184, null, 2, "Рефрижераторная установка. Температура рефрижератора в секции 2", null, null],
            [185, null, 2, "Рефрижераторная установка. Температура рефрижератора в секции 3", null, null],
            [186, null, 2, "Рефрижераторная установка. Температура установленная 1", null, null],
            [187, null, 2, "Рефрижераторная установка. Температура установленная 2", null, null],
            [188, null, 2, "Рефрижераторная установка. Температура установленная 3", null, null],
            [189, null, 2, "Рефрижераторная установка. Температура окружающего воздуха", null, null],
            [190, null, 2, "Рефрижераторная установка. Температура ОЖ", null, null],
            [191, null, 2, "Рефрижераторная установка. Напряжение аккумулятора", null, null],
            [192, null, 2, "Рефрижераторная установка. Сила тока аккумулятора", null, null],
            [193, null, 4, "Рефрижераторная установка. Моточасы работы от двигателя", null, null],
            [194, null, 4, "Рефрижераторная установка. Моточасы работы от сети", null, null],
            [195, null, 4, "Рефрижераторная установка. Количество ошибок. Код самой важной ошибки", null, null],
            [196, null, 4, "Рефрижераторная установка. Код 2-3х по важности ошибки", null, null],
            [197, null, 6, "Рефрижераторная установка. Код 4-6х по важности ошибкок", null, null],
            [198, null, 3, "Рефрижераторная установка. Состояние двигателя", null, null],
            [199, null, 1, "Рефрижераторная установка. Конфигурация компрессора", null, null],
            [200, null, 2, "Информация о нахождении в геозонах", null, null],
            [201, null, 2, "CAN. Флаги состояния безопасности", null, null],
            [202, null, 1, "CAN. События состояния безопасности", null, null],
            [203, null, 4, "CAN. Контроллеры аварии", null, null],
            [204, null, 5, "CAN. Информация о неисправностях", null, null],
            [205, null, 4, "Пользовательские моточасы 1 (работа под нагрузкой)", null, null],
            [206, null, 4, "Пользовательские моточасы 2 (работа без нагрузки)", null, null],
            [207, null, 1, "Пользовательский параметр 1 байт  №1", null, null],
            [208, null, 1, "Пользовательский параметр 1 байт   №2", null, null],
            [209, null, 1, "Пользовательский параметр 1 байт  №3", null, null],
            [210, null, 1, "Пользовательский параметр 1 байт  №4", null, null],
            [211, null, 1, "Пользовательский параметр 1 байт   №5", null, null],
            [212, null, 1, "Пользовательский параметр 1 байт  №6", null, null],
            [213, null, 1, "Пользовательский параметр 1 байт  №7", null, null],
            [214, null, 1, "Пользовательский параметр 1 байт   №8", null, null],
            [215, null, 1, "Пользовательский параметр 1 байт  №9", null, null],
            [216, null, 1, "Пользовательский параметр 1 байт  №10", null, null],
            [217, null, 1, "Пользовательский параметр 1 байт   №11", null, null],
            [218, null, 1, "Пользовательский параметр 1 байт  №12", null, null],
            [219, null, 1, "Пользовательский параметр 1 байт  №13", null, null],
            [220, null, 1, "Пользовательский параметр 1 байт   №14", null, null],
            [221, null, 1, "Пользовательский параметр 1 байт  №15", null, null],
            [222, null, 1, "Пользовательский параметр 1 байт  №16", null, null],
            [223, null, 2, "Пользовательский параметр 2 байта   №1", null, null],
            [224, null, 2, "Пользовательский параметр 2 байта  №2", null, null],
            [225, null, 2, "Пользовательский параметр 2 байта  №3", null, null],
            [226, null, 2, "Пользовательский параметр 2 байта   №4", null, null],
            [227, null, 2, "Пользовательский параметр 2 байта  №5", null, null],
            [228, null, 2, "Пользовательский параметр 2 байта  №6", null, null],
            [229, null, 2, "Пользовательский параметр 2 байта   №7", null, null],
            [230, null, 2, "Пользовательский параметр 2 байта  №8", null, null],
            [231, null, 2, "Пользовательский параметр 2 байта  №9", null, null],
            [232, null, 2, "Пользовательский параметр 2 байта   №10", null, null],
            [233, null, 2, "Пользовательский параметр 2 байта   №11", null, null],
            [234, null, 2, "Пользовательский параметр 2 байта  №12", null, null],
            [235, null, 2, "Пользовательский параметр 2 байта  №13", null, null],
            [236, null, 2, "Пользовательский параметр 2 байта   №14", null, null],
            [237, null, 2, "Пользовательский параметр 2 байта  №15", null, null],
            [238, null, 4, "Пользовательский параметр 4 байта  №1", null, null],
            [239, null, 4, "Пользовательский параметр 4 байта   №2", null, null],
            [240, null, 4, "Пользовательский параметр 4 байта  №3", null, null],
            [241, null, 4, "Пользовательский параметр 4 байта  №4", null, null],
            [242, null, 4, "Пользовательский параметр 4 байта   №5", null, null],
            [243, null, 4, "Пользовательский параметр 4 байта  №6", null, null],
            [244, null, 4, "Пользовательский параметр 4 байта  №7", null, null],
            [245, null, 4, "Пользовательский параметр 4 байта   №8", null, null],
            [246, null, 4, "Пользовательский параметр 4 байта  №9", null, null],
            [247, null, 4, "Пользовательский параметр 4 байта  №10", null, null],
            [248, null, 4, "Пользовательский параметр 4 байта   №11", null, null],
            [249, null, 4, "Пользовательский параметр 4 байта  №12", null, null],
            [250, null, 4, "Пользовательский параметр 4 байта  №13", null, null],
            [251, null, 4, "Пользовательский параметр 4 байта   №14", null, null],
            [252, null, 4, "Пользовательский параметр 4 байта  №15", null, null],
            [253, null, 8, "Пользовательский параметр 8 байт  №1", null, null],
            [254, null, 8, "Пользовательский параметр 8 байт  №2", null, null],
            [255, null, 8, "Пользовательский параметр 8 байт  №3", null, null]
        ];
    }
}
